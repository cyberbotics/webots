## Using Webots Makefiles

### What are Makefiles

The compilation of Webots C/C++ and Java controllers can be configured in the provided Makefiles.
A controller's Makefile is a configuration file used by the `make` utility and that optionally specifies a list of source files and how they will be compiled and linked to create the executable program.

Note that Python and *MATLAB*<sup>TM</sup> are interpreted languages and therefore they don't need Makefiles.
So if you are using any of these programming languages or Visual Studio then you can ignore this section.

When using C/C++ or Java, the presence of a Makefile in the controller directory is necessary.
If the Makefile is missing Webots will automatically propose to create one.
This Makefile can be modified with a text editor; its purpose is to define project specific variables and to include the global "Makefile.include" file.
The global "Makefile.include" file is stored in "WEBOTS\_HOME/resources/" directory; it contains the effective build rules and may vary with the Webots version.
Note that Webots Makefiles are platform and language independent.

### Controller with Several Source Files (C/C++)

If a controller requires several C/C++ source files they need to be specified in the Makefile.
The name of each source file must be listed, using one of these variables:

%figure "Webots Makefile Sources Variables"

| Variable     | Usage                                                |
| ------------ | ---------------------------------------------------- |
| C\_SOURCES   | Specifies a list of .c sources files                 |
| CXX\_SOURCES | Specifies a list of .cpp, *.cc or *.c++ source files |

%end

Every source file specified using these variables, will be added to the controller build.
In addition, dependency files will be automatically generated by the `make` command in order to minimize the build.
Note that these variables should not be used in any language other than C or C++.

For example, if a controller has several ".c" source files, then this can be specified like this in the controller's Makefile:

```makefile
C_SOURCES = my_controller.c my_second_file.c my_third_file.c
```

If a project has several ".cpp" source files, then this can be specified like such:

```makefile
CXX_SOURCES = my_controller.cpp my_second_file.cpp my_third_file.cc
```

Important: the build rules require that one of the source files in the list must correspond to the controller name (i.e. controller directory name), e.g. if the controller directory is "my\_controller" then the list must contain either "my\_controller.c, my\_controller.cpp" or "my\_controller.cc" accordingly.

### Using the Compiler and Linker Flags (C/C++)

These variables can be used to pass flags to the gcc compiler or linker.

%figure "Webots Makefile Compiler Variables"

| Variable  | Usage                                                                                                      |
| --------- | ---------------------------------------------------------------------------------------------------------- |
| CFLAGS    | Specifies a list of flags that will be passed to the gcc/g++ compiler                                      |
| LFLAGS    | Specifies a list of flags that will be passed to the linker                                                |
| INCLUDE   | Specifies directories to be added to the list of places searched by the gcc/g++ compiler for include files |
| LIBRARIES | Specifies library search directories and libraries passed to the linker                                    |

%end

#### Adding an External Library (C/C++)

Webots C/C++ controllers are regular binary executable files that can easily be compiled and linked with external libraries.
To add an external library it is only necessary to specify the path to the header files, and the path and name of the library in the controller's Makefile.
For example the `-I`*dir* flag can be added in the INCLUDE variable to specify a directory to search for include files.
The LIBRARIES variable can be used to pass flags to the linker.
For example the `-L`*dir* flag can be used to add a directory to search for static or dynamic libraries, and the `-l` flag can be used to specify the name of a library that needs to be linked with the controller.

For example, let's assume that you would like to add an external library called *XYZLib*.
And let's assume that the library's header files and ".dll" file are located like this (Windows):

```
C:\Users\YourName\XYZLib\include\XYZLib.h
C:\Users\YourName\XYZLib\lib\XYZLib.dll
```

Then here is how this should be specified in the Makefile:

```makefile
INCLUDE = -I"C:\Users\YourName\XYZLib\include"
LIBRARIES = -L"C:\Users\YourName\XYZLib\lib" -lXYZLib
```

The first line tells gcc where to look for the *#include<XYZLib.h>* file.
The second line tells gcc to link the executable controller with the "XYZLib.dll" and where that ".dll" can be found.
Note that this would be similar on Linux and macOS, you would just need to use UNIX-compatible paths instead.
If more external libraries are required, it is always possible to use additional `-I, -L` and `-l` flags.
For more information on these flags, please refer to the `gcc` man page.

CFLAGS is equivalent to INCLUDE but it is suggested to use it for specifying other gcc/g++ compilation options than adding include directories.
Similarly, LFLAGS is equivalent to LIBRARIES but LFLAGS variable is added before LIBRARIES variable in the linker command and it is suggested to use it for other linking options than adding libraries.
You can find a list of compiler and linker options on the [gcc website](https://gcc.gnu.org/onlinedocs/gcc/Option-Summary.html#Option-Summary).

#### Using Webots C API in a C++ Controller

Normally, C++ controllers use Webots C++ API.
The C++ API is a set of C++ classes provided by C++ header files, e.g. `#include <webots/Robot.hpp>`.
If you prefer, C++ controllers can use Webots C API instead.
The C API is a set of C functions starting with the `wb` prefix and provided by C header files, e.g. `#include <webots/robot.h>`.
To use the C API in a C++ controller you need to add this line in your controller Makefile:

```makefile
USE_C_API = true
```

#### Verbose Compilation

It is possible to display detailed information about the executed sequence of commands by setting the VERBOSE variable to a non-empty value in your controller Makefile:

```makefile
VERBOSE = 1
```

#### Adding Debug Information

If you need to debug your controller, you need to recompile it with the `debug` target from a terminal:

```sh
make debug
```

This will instruct gcc to add debugging information so that the executable can be debugged using gcc.
