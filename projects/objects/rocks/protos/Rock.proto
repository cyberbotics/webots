#VRML_SIM R2023b utf8
# license: Copyright Cyberbotics Ltd. Licensed for use only with Webots.
# license url: https://cyberbotics.com/webots_assets_license
# documentation url: https://webots.cloud/run?url=https://github.com/cyberbotics/webots/blob/released/projects/objects/rocks/protos/Rock17cm.proto
# keywords: exterior/obstacle
# A rock with a flat underside.
# template language: javascript

PROTO Rock [
  field SFVec3f                     translation       0 0 0
  field SFRotation                  rotation          0 0 1 0
  field SFString                    name              "rock"
  field SFString{"regular", "flat"} type              "regular"            # Defines the rock variant.
  field SFFloat                     scale             1                    # Defines the scale of the rock.
  field MFString                    texture           "webots://projects/default/worlds/textures/rock.jpg"  # Defines the texture used for the rock.
  field SFColor                     color             1 1 1                # Defines the base color of the rock.
  field SFNode                      physics           NULL                 # Is `Solid.physics`.
  field SFBool                      locked            FALSE                # Is `Solid.locked`.
]
{
  %<
    import * as wbvector3 from 'wbvector3.js';

    const scale = fields.scale.value;
    const type = fields.type.value;

    // mesh of the regular rock
    const regularRockMesh = [{x: 0.0282555, y: -0.0123062, z: 0.0493622}, {x: 0.0514526, y: 0.0516891, z: 0.0471497}, {x: 0.0213318, y: 0.0449829, z: 0.0468445}, {x: 0.0608444, y: 0.0574036, z: 0.032486}, {x: -0.01614, y: 0.0463638, z: 0.0209618}, {x: -0.0175323, y: 0.0003681, z: 0.0294952}, {x: 0.0659485, y: 0.0076895, z: -0.0014772}, {x: 0.029644, y: -0.0428085, z: 0.0261192}, {x: -0.0213318, y: -0.040596, z: 0.0248642}, {x: 0.0575638, y: -0.0246735, z: 0.0051146}, {x: 0.0346298, y: 0.055397, z: 0.0064392}, {x: -0.0625458, y: -0.0035353, z: 0.0255203}, {x: 0.004591, y: -0.0539703, z: -0.0393677}, {x: -0.0445328, y: -0.031601, z: 0.0104427}, {x: -0.0316048, y: -0.0461426, z: -0.0520782}, {x: 0.0381699, y: -0.018795, z: -0.0489807}, {x: -0.0555496, y: -0.0468445, z: -0.0379105}, {x: -0.0018876, y: 0.0425644, z: -0.0396271}, {x: -0.066803, y: -0.0030928, z: -0.029541}, {x: -0.0359573, y: -0.0154018, z: -0.0562286}, {x: -0.0384674, y: 0.0333023, z: -0.0195274}];
    const flatRockMesh = [{x: 0.0785826, y: 0.1024746, z: 0.1040181}, {x: 0.1194228, y: 0.1299862, z: 0}, {x: 0.0095452, y: 0.1296811, z: 0}, {x: 0.1900481, y: 0.0733609, z: 0}, {x: -0.1310426, y: 0.0832104, z: 0}, {x: -0.0165998, y: 0.0745358, z: 0.0992955}, {x: 0.159561, y: 0.0128388, z: 0.0731114}, {x: 0.0813597, y: 0.0559849, z: 0.1650304}, {x: -0.0205938, y: 0.0534748, z: 0.1606053}, {x: 0.1372069, y: 0.0139765, z: 0.1287526}, {x: 0.2200468, y: -0.0600124, z: 0}, {x: -0.1030199, y: 0.0547833, z: 0.0864781}, {x: 0.0203837, y: -0.0875965, z: 0.1758641}, {x: -0.1510622, y: 0.0718274, z: 0}, {x: -0.0669862, y: 0.0246319, z: 0.1426152}, {x: -0.0411379, y: -0.1004062, z: 0.1716909}, {x: 0.0142792, y: -0.1276279, z: 0.1150121}, {x: -0.0890276, y: -0.0720783, z: 0.1730947}, {x: 0.0197981, y: -0.1235462, z: 0}, {x: -0.1124422, y: -0.0817371, z: 0.1118459}, {x: -0.049843, y: -0.1087146, z: 0.1102132}, {x: -0.1737215, y: 0.0036597, z: 0}, {x: -0.0947572, y: -0.1227069, z: 0}];

    const mesh = type === 'regular' ? regularRockMesh : flatRockMesh;
    let meshBuffer = '';
    for (let i = 0; i  < mesh.length; ++i) {
      const point = wbvector3.multiply(mesh[i], scale);
      meshBuffer += `${point.x} ${point.y} ${point.z}, `;
    }
    meshBuffer = meshBuffer.slice(0, -2);
  >%
  Solid {
    translation IS translation
    rotation IS rotation
    children [
      Shape {
        appearance PBRAppearance {
          baseColor IS color
          baseColorMap ImageTexture {
            url IS texture
          }
          roughness 1
          metalness 0
        }
        %< if (type === 'regular') { >%
          geometry DEF IFS IndexedFaceSet {
            coord Coordinate {
              point [
                %<= meshBuffer >%
              ]
            }
            coordIndex [
              2 0 1 -1, 1 0 3 -1, 4 0 2 -1, 0 4 5 -1, 3 0 6 -1, 7 0 5 -1, 6 0 7 -1, 8 7 5 -1, 6 7 9 -1, 10 3 6 -1, 11 5 4 -1, 11 8 5 -1, 12 7 8 -1, 12 9 7 -1, 6 9 12 -1, 13 8 11 -1, 14 12 8 -1, 15 6 12 -1, 15 10 6 -1, 13 11 16 -1, 16 8 13 -1, 14 8 16 -1, 15 12 14 -1, 10 15 17 -1, 18 11 4 -1, 16 11 18 -1, 14 16 19 -1, 15 14 19 -1, 19 16 18 -1, 19 17 15 -1, 18 20 19 -1, 17 19 20 -1, 4 20 18 -1, 4 17 20 -1, 4 10 17 -1, 2 10 4 -1, 1 3 10 -1, 1 10 2 -1
            ]
            texCoord TextureCoordinate {
              point [
                0.6519888 0.9328683, 0.7415154 0.7278224, 0.7583726 0.9886748, 0.7586426 0.7597129, 0.8404567 0.5771889, 0.7916614 0.8227384, 0.4865306 0.8964634, 0.7415154 0.7278224, 0.6519888 0.9328683, 0.7415154 0.7278224, 0.4865306 0.8964634, 0.5380667 0.7254828, 0.7916614 0.8227384, 0.8404567 0.5771889, 0.9466503 0.8113729, 0.9085732 1.0, 0.758906 0.9799206, 0.7586426 0.8227384, 0.9466503 0.8113729, 0.8404567 0.5771889, 0.9469442 0.5691234, 0.563445 0.5691234, 0.7586426 0.613364, 0.5380667 0.7254828, 0.1250233 0.861748, 0.124784 0.633634, 0.1660463 0.739833, 0.1450739 0.0904869, 0.2137036 0.0, 0.3691042 0.1395276, 0.3694084 0.6643548, 0.5380667 0.7254828, 0.4865306 0.8964634, 0.3694084 0.6643548, 0.563445 0.5691234, 0.5380667 0.7254828, 0.6877791 0.289174, 0.8347366 0.0551657, 0.9323464 0.1935238, 0.6877791 0.289174, 0.6879001 0.0, 0.8347366 0.0551657, 0.9323465 0.0864366, 0.9999999 0.1926008, 0.9326506 0.4389925, 0.3031699 0.8246872, 0.3694084 0.8976216, 0.1660463 0.8671747, 0.7113631 0.4050269, 0.6877791 0.289174, 0.9323464 0.1935238, 0.0 0.8388469, 0.1122519 0.633634, 0.1122419 0.9866771, 0.3654387 0.3123293, 0.1450739 0.0904869, 0.3691042 0.1395276, 0.3031699 0.8246872, 0.1660463 0.8671747, 0.3569988 0.633634, 0.3569988 0.633634, 0.3694084 0.8976216, 0.3031699 0.8246872, 0.7113631 0.4050269, 0.9323464 0.1935238, 0.807003 0.4389925, 0.3654387 0.3123293, 0.3694084 0.4920835, 0.2444831 0.5753585, 0.1450739 0.0904869, 0.3654387 0.3123293, 0.0779419 0.2491205, 0.4751778 0.0, 0.6872136 0.0613657, 0.6173913 0.26805, 0.3569988 0.633634, 0.1660463 0.8671747, 0.1764471 0.656506, 0.2444831 0.5753585, 0.178291 0.633634, 0.1451926 0.5064259, 0.3654387 0.3123293, 0.2444831 0.5753585, 0.1451926 0.5064259, 0.1451926 0.5064259, 0.178291 0.633634, 0.022482 0.5410983, 0.1451926 0.5064259, 0.0779419 0.2491205, 0.3654387 0.3123293, 0.022482 0.5410983, 0.0 0.3611155, 0.1451926 0.5064259, 0.0779419 0.2491205, 0.1451926 0.5064259, 0.0 0.3611155, 0.6173913 0.26805, 0.4810471 0.1416896, 0.4751778 0.0, 0.6173913 0.26805, 0.3694084 0.2665703, 0.4810471 0.1416896, 0.6173913 0.26805, 0.5157984 0.4494928, 0.3694084 0.2665703, 0.6877791 0.4261287, 0.5157984 0.4494928, 0.6173913 0.26805, 0.6620587 0.5423295, 0.5953204 0.5691234, 0.5157984 0.4494928, 0.6620587 0.5423295, 0.5157984 0.4494928, 0.6877791 0.4261287
              ]
            }
            texCoordIndex [
              0 1 2 -1 3 4 5 -1 6 7 8 -1 9 10 11 -1 12 13 14 -1 15 16 17 -1 18 19 20 -1 21 22 23 -1 24 25 26 -1 27 28 29 -1 30 31 32 -1 33 34 35 -1 36 37 38 -1 39 40 41 -1 42 43 44 -1 45 46 47 -1 48 49 50 -1 51 52 53 -1 54 55 56 -1 57 58 59 -1 60 61 62 -1 63 64 65 -1 66 67 68 -1 69 70 71 -1 72 73 74 -1 75 76 77 -1 78 79 80 -1 81 82 83 -1 84 85 86 -1 87 88 89 -1 90 91 92 -1 93 94 95 -1 96 97 98 -1 99 100 101 -1 102 103 104 -1 105 106 107 -1 108 109 110 -1 111 112 113 -1
            ]
          }
        %< } else { >%
          geometry DEF IFS IndexedFaceSet {
            coord Coordinate {
              point [
                %<= meshBuffer >%
              ]
            }
            coordIndex [
              2 0 1 -1, 1 0 3 -1, 4 0 2 -1, 0 4 5 -1, 3 0 6 -1, 7 0 5 -1, 6 0 7 -1, 8 7 5 -1, 6 7 9 -1, 10 3 6 -1, 11 5 4 -1, 11 8 5 -1, 12 7 8 -1, 12 9 7 -1, 6 9 12 -1, 13 11 4 -1, 14 8 11 -1, 15 12 8 -1, 16 6 12 -1, 16 10 6 -1, 14 11 17 -1, 17 8 14 -1, 15 8 17 -1, 16 12 15 -1, 10 16 18 -1, 19 11 13 -1, 17 11 19 -1, 15 17 20 -1, 16 15 20 -1, 19 13 21 -1, 20 17 19 -1, 20 18 16 -1, 19 21 22 -1, 19 22 20 -1, 18 20 22 -1, 2 18 4 -1, 4 18 13 -1, 13 18 21 -1, 18 22 21 -1, 2 10 18 -1, 2 3 10 -1, 1 3 2 -1
            ]
            texCoord TextureCoordinate {
              point [
                0.478856 0.4398897, 0.6447655 0.7644726, 0.7429118 0.4398897, 0.7429118 0.4398897, 0.6447655 0.7644726, 0.9126372 0.4398897, 0.1409979 0.4398897, 0.6447655 0.7644726, 0.478856 0.4398897, 0.6447655 0.7644726, 0.1409979 0.4398897, 0.4160247 0.7497361, 0.4559171 0.210971, 0.7058915 0.120123, 0.6316171 0.3998269, 0.6514394 0.9548582, 0.6447655 0.7644726, 0.4160247 0.7497361, 0.6316171 0.3998269, 0.7058915 0.120123, 0.852515 0.2651917, 0.4064265 0.9410501, 0.6514394 0.9548582, 0.4160247 0.7497361, 0.8393712 0.66803, 0.6514394 0.9548582, 0.7856503 0.8416553, 0.4559171 0.6271554, 0.4559171 0.210971, 0.6316171 0.3998269, 0.2083417 0.70974, 0.4160247 0.7497361, 0.1409979 0.4398897, 0.2083417 0.70974, 0.4064265 0.9410501, 0.4160247 0.7497361, 0.5049029 0.7132297, 0.6514394 0.2651917, 0.4064265 0.2730242, 0.5049029 0.7132297, 0.7856503 0.3962767, 0.6514394 0.2651917, 0.6316171 0.3998269, 0.7653329 0.3962767, 0.8785505 0.7132297, 0.0928873 0.4398897, 0.2083417 0.70974, 0.1409979 0.4398897, 0.294937 0.363027, 0.4064265 0.2730242, 0.2083417 0.2689413, 0.3570554 0.7532018, 0.5049029 0.7132297, 0.4064265 0.2730242, 0.732312 0.8381456, 0.6316171 0.3998269, 0.8785505 0.7132297, 0.4902328 0.8381456, 0.9847296 0.6271554, 0.8393712 0.3998269, 0.7986473 0.363027, 0.6637397 0.2689413, 0.871895 0.664806, 0.2419677 0.664806, 0.4064265 0.2730242, 0.294937 0.363027, 0.3570554 0.7532018, 0.4064265 0.2730242, 0.2419677 0.664806, 0.4902328 0.7987787, 0.5049029 0.9886644, 0.3570554 0.9756418, 0.9847296 0.4398897, 0.4902328 0.7987787, 0.5034957 0.4398897, 0.724703 0.6949458, 0.6637397 0.2689413, 0.4559171 0.2157562, 0.871895 0.664806, 0.6637397 0.2689413, 0.724703 0.6949458, 0.3570554 0.9756418, 0.2419677 0.9800223, 0.3361353 0.7838039, 0.4902328 0.7987787, 0.3570554 0.9756418, 0.3361353 0.7838039, 0.724703 0.6949458, 0.4559171 0.2157562, 0.4559171 0.4284699, 0.3361353 0.7838039, 0.2419677 0.9800223, 0.1856982 0.7888987, 0.3361353 0.7838039, 0.5034957 0.4398897, 0.4902328 0.7987787, 0.724703 0.6949458, 0.4559171 0.4284699, 0.4559171 0.82279, 0.1856982 0.7888987, 0.2281983 0.4398897, 0.3361353 0.7838039, 0.5034957 0.4398897, 0.3361353 0.7838039, 0.2281983 0.4398897, 0.478856 0.0352268, 0.5034957 0.8254088, 0.1409979 0.180236, 0.1409979 0.180236, 0.5034957 0.8254088, 0.0928873 0.2157562, 0.0928873 0.2157562, 0.5034957 0.8254088, 0.0384329 0.4284699, 0.5034957 0.8254088, 0.2281983 0.82279, 0.0384329 0.4284699, 0.478856 0.0352268, 0.9847296 0.6271554, 0.5034957 0.8254088, 0.478856 0.0352268, 0.9126372 0.210971, 0.9847296 0.6271554, 0.7429118 0.0342745, 0.9126372 0.210971, 0.478856 0.0352268
              ]
            }
            texCoordIndex [
              0 1 2 -1 3 4 5 -1 6 7 8 -1 9 10 11 -1 12 13 14 -1 15 16 17 -1 18 19 20 -1 21 22 23 -1 24 25 26 -1 27 28 29 -1 30 31 32 -1 33 34 35 -1 36 37 38 -1 39 40 41 -1 42 43 44 -1 45 46 47 -1 48 49 50 -1 51 52 53 -1 54 55 56 -1 57 58 59 -1 60 61 62 -1 63 64 65 -1 66 67 68 -1 69 70 71 -1 72 73 74 -1 75 76 77 -1 78 79 80 -1 81 82 83 -1 84 85 86 -1 87 88 89 -1 90 91 92 -1 93 94 95 -1 96 97 98 -1 99 100 101 -1 102 103 104 -1 105 106 107 -1 108 109 110 -1 111 112 113 -1 114 115 116 -1 117 118 119 -1 120 121 122 -1 123 124 125 -1
            ]
          }
        %< } >%
      }
    ]
    name IS name
    model "rock"
    boundingObject USE IFS
    physics IS physics
    locked IS locked
  }
}
