<html>
  <body>
    <script src="./wrenjs.js"></script>
    <script type="text/javascript" src="./dependencies/assimpjs.js"></script>
    <h>Test</h>
    <div id="resultDiv"></div>

  </body>
<html>

<script>
assimpjs ().then (function (ajs) {
    // fetch the files to import
    let files = [
        'https://raw.githubusercontent.com/cyberbotics/webots/enhancement-assimp-webotsjs/projects/robots/robotnik/summit_xl_steel/protos/meshes/robotnik_logo_chasis.stl'
    ];
    Promise.all (files.map ((file) => fetch (file))).then ((responses) => {
        return Promise.all (responses.map ((res) => res.arrayBuffer ()));
    }).then ((arrayBuffers) => {
        const resultDiv = document.getElementById("resultDiv");
        // create new file list object, and add the files
        let fileList = new ajs.FileList ();
        for (let i = 0; i < files.length; i++) {
            fileList.AddFile (files[i], new Uint8Array (arrayBuffers[i]));
        }

        // convert file list to assimp json
        let result = ajs.ConvertFileList (fileList, 'assjson', true);

        // check if the conversion succeeded
        if (!result.IsSuccess () || result.FileCount () == 0) {
            resultDiv.innerHTML = result.GetErrorCode ();
            return;
        }

        // get the result file, and convert to string
        let resultFile = result.GetFile (0);
        let jsonContent = new TextDecoder ().decode (resultFile.GetContent ());

        // parse the result json
        let resultJson = JSON.parse (jsonContent);
        console.log(resultJson)
        resultDiv.innerHTML = JSON.stringify (resultJson, null, 4);
    });
});
</script>
